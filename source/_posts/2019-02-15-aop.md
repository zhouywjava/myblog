---
title: 读书笔记：aop 概述
date: 2019-02-15 11:08:28
tags: 
- framework
- spring ioc
comments: true
categories: 
- Java架构
- 源码
---

在使用公共函数的时候，往往也需要进行一些逻辑设计，而这些逻辑代码也是需要维护的。这时就是AOP大显身手的时候，使用AOP后，不仅可以将这些重复的代码抽取出来单独维护，再需要的时候统一调用，还可以为如何使用这些公共代码提供丰富灵活的手段。
目前AOP联盟的网站上有一下的AOP技术：
AspectJ:源代码和字节码级别的编织器，用户需要使用不同于Java的新语言。
AspectWerkz:AOP 框架，使用字节码动态编织器和XML配置。
JBoss-AOP:基于拦截器和元数据的AOP框架，运行再JBoss应用服务器上。以及再AOP中用到的一些相关的技术实现：
    BCEL：java字节码操作类库
    javassist:java字节码操作类库
<!--more-->

1. advice 通知。是一个接口。这个接口，有具体的通知类型，比如Beforeadvice、Afteradvice、Throwsadvice等。而通知就是借助接口来规范切点，前，后，抛出异常时，需要做的逻辑。

2. Pointcut 切点。决定advice通知应该作用于哪个连接点。
看下Pointcut 的子类族谱：
{% asset_img Pointcut.png point cut %}
其中我们可以知道Pointcut基本接口定义中，需要返回一个MethodMatcher。对于Point的匹配判断功能，具体是由这个返回的MethodMatcher来完成。由这个MethodMatcher来判断是否要对当前调用的方法应用配置好的advice通知。
我们以JdkRegexpMethodPointcut的实现原理为例，来了解Pointcut的工作原理。
JdkRegexpMethodPointcut的基类：
{% asset_img jdkRegexpMethodPointcut.png JdkRegexpMethodPointcut %}
可以看出其实JdkRegexpMethodPointcut的基类是StaticMethodMatcher。
因此看得出MethodMatcher对象实际上是可以被配置成JdkRegexpMethodPointcut来完成方法的匹配判断的，即需要返回MethodMatcher，实际上是返回对象本身。
因此，再JdkRegexpMethodPointcut中可以看到一个matches方法，MethodMatcher接口中，就是约定了通过matches方法的具体实现来，用正则表达式来对方法名进行匹配的地方。

3. advisor 通知器 完成对目标方法的切面增强 advice 和 关注点的设计 Pointcut 以后，需要一个对象把他们结合起来，这个就是advisor(通知器)。
DefaultPointcutAdvisor 是一个默认的通知器，再这个通知器中，默认聚合了一个切点是	private Pointcut Pointcut = Pointcut.TRUE; 即 TruePointcut。该切面返回的MethodMatcher 是TrueMethodMatcher 。 其matcher 方法对所有方法均返回true。表示针对所有方法。
DefaultPointcutAdvisor 的基类AbstractGenericPointcutAdvisor ，该基类可以指定advice ，从而 DefaultPointcutAdvisor 可以使用Pointcut 获得 MethodMathcher 去判断一个方法是否需求增强。如果需要则使用设置的advice 来进行通知处理。
END



